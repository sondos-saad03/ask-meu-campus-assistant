import OpenAI from 'openai';

// Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø·
const MEU_KNOWLEDGE_BASE = {
  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ø§Ù…Ø© Ø¹Ù† Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©
  general: {
    name: 'Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø·',
    englishName: 'Middle East University',
    location: 'Ø¹Ù…Ø§Ù†ØŒ Ø§Ù„Ø£Ø±Ø¯Ù†',
    founded: '2005',
    type: 'Ø¬Ø§Ù…Ø¹Ø© Ø®Ø§ØµØ©',
    accreditation: 'Ù…Ø¹ØªÙ…Ø¯Ø© Ù…Ù† ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø¹Ø§Ù„ÙŠ ÙˆØ§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ Ø§Ù„Ø£Ø±Ø¯Ù†ÙŠØ©',
    website: 'www.meu.edu.jo'
  },

  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„
  registration: {
    'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯': 'ÙŠØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Ù‹ Ø¹Ø¨Ø± Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ. Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ØªÙØ¹Ù„Ù† Ù‚Ø¨Ù„ Ø¨Ø¯Ø§ÙŠØ© ÙƒÙ„ ÙØµÙ„. ÙŠØ­Ù‚ Ù„Ù„Ø·Ø§Ù„Ø¨ ØªØ³Ø¬ÙŠÙ„ 12-18 Ø³Ø§Ø¹Ø© Ù…Ø¹ØªÙ…Ø¯Ø© ÙÙŠ Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¹Ø§Ø¯ÙŠ.',
    'Ø§Ù„Ø±Ø³ÙˆÙ…': 'ØªØ®ØªÙ„Ù Ø§Ù„Ø±Ø³ÙˆÙ… Ø­Ø³Ø¨ Ø§Ù„ØªØ®ØµØµ. ÙŠØªÙ… Ø¯ÙØ¹ Ø§Ù„Ø±Ø³ÙˆÙ… Ø¹Ø¨Ø± Ø§Ù„Ø¨Ù†ÙˆÙƒ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© Ø£Ùˆ Ø¹Ø¨Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ. ÙŠÙˆØ¬Ø¯ Ø®ØµÙˆÙ…Ø§Øª Ù„Ù„Ù…ØªÙÙˆÙ‚ÙŠÙ† ÙˆØ£Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ù†ØªØ³Ø¨ÙŠÙ†.',
    'Ø§Ù„Ù…Ù†Ø­': 'ØªÙ‚Ø¯Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© Ù…Ù†Ø­ Ø¬Ø²Ø¦ÙŠØ© ÙˆÙƒØ§Ù…Ù„Ø© Ù„Ù„Ø·Ù„Ø¨Ø© Ø§Ù„Ù…ØªÙÙˆÙ‚ÙŠÙ†. Ù…Ù†Ø­Ø© Ø§Ù„ØªÙ…ÙŠØ² Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ Ù„Ù„Ø­Ø§ØµÙ„ÙŠÙ† Ø¹Ù„Ù‰ Ù…Ø¹Ø¯Ù„ 90% ÙØ£ÙƒØ«Ø± ÙÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø©.',
    'Ø§Ù„Ø§Ù†Ø³Ø­Ø§Ø¨': 'ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§Ù†Ø³Ø­Ø§Ø¨ Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ø¯ Ø®Ù„Ø§Ù„ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…Ù† Ø§Ù„ÙØµÙ„. Ø¨Ø¹Ø¯ Ø°Ù„Ùƒ ÙŠÙØ³Ø¬Ù„ Ø§Ù†Ø³Ø­Ø§Ø¨ ÙˆÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø¯Ù„.',
    'Ø§Ù„ØªØ£Ø¬ÙŠÙ„': 'ÙŠÙ…ÙƒÙ† ØªØ£Ø¬ÙŠÙ„ Ø§Ù„ÙØµÙ„ Ù„Ø£Ø³Ø¨Ø§Ø¨ Ù…Ø¨Ø±Ø±Ø© Ø¨Ø¹Ø¯ ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø±Ø³Ù…ÙŠ Ù„Ø¹Ù…Ø§Ø¯Ø© Ø§Ù„Ù‚Ø¨ÙˆÙ„ ÙˆØ§Ù„ØªØ³Ø¬ÙŠÙ„.'
  },

  // Ø§Ù„ÙƒÙ„ÙŠØ§Øª ÙˆØ§Ù„ØªØ®ØµØµØ§Øª
  faculties: {
    'ÙƒÙ„ÙŠØ© ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª': [
      'Ø¹Ù„ÙˆÙ… Ø§Ù„Ø­Ø§Ø³ÙˆØ¨',
      'Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ§Øª', 
      'Ù†Ø¸Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø§Ø³ÙˆØ¨ÙŠØ©',
      'Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ',
      'Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ'
    ],
    'ÙƒÙ„ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„': [
      'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„',
      'Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©',
      'Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ÙˆØ§Ù„Ù…ØµØ§Ø±Ù',
      'Ø§Ù„ØªØ³ÙˆÙŠÙ‚',
      'Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯'
    ],
    'ÙƒÙ„ÙŠØ© Ø§Ù„Ù‡Ù†Ø¯Ø³Ø©': [
      'Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ù…Ø¯Ù†ÙŠØ©',
      'Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©',
      'Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©',
      'Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ø¹Ù…Ø§Ø±Ø©'
    ],
    'ÙƒÙ„ÙŠØ© Ø§Ù„Ø¢Ø¯Ø§Ø¨ ÙˆØ§Ù„Ø¹Ù„ÙˆÙ…': [
      'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ¢Ø¯Ø§Ø¨Ù‡Ø§',
      'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ¢Ø¯Ø§Ø¨Ù‡Ø§',
      'Ø§Ù„ØªØ±Ø¬Ù…Ø©',
      'Ø¹Ù„Ù… Ø§Ù„Ù†ÙØ³',
      'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª'
    ],
    'ÙƒÙ„ÙŠØ© Ø§Ù„Ø­Ù‚ÙˆÙ‚': [
      'Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†'
    ],
    'ÙƒÙ„ÙŠØ© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù…': [
      'Ø§Ù„ØµØ­Ø§ÙØ© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù…',
      'Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†'
    ]
  },

  // Ø§Ù„Ø®Ø¯Ù…Ø§Øª ÙˆØ§Ù„Ù…Ø±Ø§ÙÙ‚
  facilities: {
    'Ø§Ù„Ù…ÙƒØªØ¨Ø©': 'Ù…ÙƒØªØ¨Ø© Ù…Ø±ÙƒØ²ÙŠØ© Ù…Ø¬Ù‡Ø²Ø© Ø¨Ø£Ø­Ø¯Ø« Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª. Ù…ÙØªÙˆØ­Ø© Ù…Ù† 8 ØµØ¨Ø§Ø­Ø§Ù‹ Ø­ØªÙ‰ 8 Ù…Ø³Ø§Ø¡Ù‹. ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£ÙƒØ«Ø± Ù…Ù† 50,000 ÙƒØªØ§Ø¨ ÙˆÙ‚ÙˆØ§Ø¹Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©.',
    'Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª': 'Ù…Ø®ØªØ¨Ø±Ø§Øª Ø­Ø§Ø³ÙˆØ¨ Ù…ØªØ·ÙˆØ±Ø©ØŒ Ù…Ø®ØªØ¨Ø±Ø§Øª Ø¹Ù„Ù…ÙŠØ© Ù…Ø¬Ù‡Ø²Ø©ØŒ Ù…Ø®ØªØ¨Ø±Ø§Øª Ù‡Ù†Ø¯Ø³ÙŠØ© Ù…ØªØ®ØµØµØ©.',
    'Ø§Ù„Ù‚Ø§Ø¹Ø§Øª': 'Ù‚Ø§Ø¹Ø§Øª Ø¯Ø±Ø§Ø³ÙŠØ© Ù…ÙƒÙŠÙØ© ÙˆÙ…Ø¬Ù‡Ø²Ø© Ø¨Ø£Ø¬Ù‡Ø²Ø© Ø¹Ø±Ø¶ Ø­Ø¯ÙŠØ«Ø©. Ù…Ø¯Ø±Ø¬ ÙƒØ¨ÙŠØ± ÙŠØªØ³Ø¹ Ù„Ù€ 300 Ø·Ø§Ù„Ø¨.',
    'Ø§Ù„ÙƒØ§ÙØªÙŠØ±ÙŠØ§': 'ÙƒØ§ÙØªÙŠØ±ÙŠØ§ Ø±Ø¦ÙŠØ³ÙŠØ© ØªÙ‚Ø¯Ù… ÙˆØ¬Ø¨Ø§Øª Ù…ØªÙ†ÙˆØ¹Ø©. Ù…ÙØªÙˆØ­Ø© Ù…Ù† 7:30 ØµØ¨Ø§Ø­Ø§Ù‹ Ø­ØªÙ‰ 6 Ù…Ø³Ø§Ø¡Ù‹.',
    'Ø§Ù„Ù…ÙˆØ§Ù‚Ù': 'Ù…ÙˆØ§Ù‚Ù Ù…Ø¬Ø§Ù†ÙŠØ© Ù„Ù„Ø·Ù„Ø¨Ø© ÙˆØ£Ø¹Ø¶Ø§Ø¡ Ù‡ÙŠØ¦Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ³. Ù…ÙˆØ§Ù‚Ù Ù…Ø¸Ù„Ù„Ø© ÙˆÙ…ÙˆØ§Ù‚Ù Ù…ÙØªÙˆØ­Ø©.',
    'Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨': 'Ù…Ù„Ø¹Ø¨ ÙƒØ±Ø© Ù‚Ø¯Ù…ØŒ Ù…Ù„Ø¹Ø¨ ÙƒØ±Ø© Ø³Ù„Ø©ØŒ ØµØ§Ù„Ø© Ø±ÙŠØ§Ø¶ÙŠØ© Ù…ØºÙ„Ù‚Ø©.',
    'Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©': 'Ø¹ÙŠØ§Ø¯Ø© Ø·Ø¨ÙŠØ© Ù„ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© ÙˆØ§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©.'
  },

  // Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª ÙˆØ§Ù„Ø¯Ø±Ø¬Ø§Øª
  exams: {
    'Ø§Ù„Ù†ØµÙÙŠ': 'Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ù†ØµÙ Ø§Ù„ÙØµÙ„ ØªÙØ¹Ù‚Ø¯ ÙÙŠ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù…Ù† Ù…Ù† Ø§Ù„ÙØµÙ„. ØªØ´ÙƒÙ„ 30% Ù…Ù† Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©.',
    'Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ': 'Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ÙŠØ´ÙƒÙ„ 40% Ù…Ù† Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©. ÙŠÙØ¹Ù‚Ø¯ ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØµÙ„ Ø­Ø³Ø¨ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„Ù†.',
    'Ø§Ù„Ø£Ø¹Ù…Ø§Ù„': 'Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„ÙØµÙ„ ØªØ´Ù…Ù„ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù‚ØµÙŠØ±Ø© ÙˆØªØ´ÙƒÙ„ 30% Ù…Ù† Ø§Ù„Ø¯Ø±Ø¬Ø©.',
    'Ø§Ù„Ù…Ø¹Ø¯Ù„': 'Ø§Ù„Ù…Ø¹Ø¯Ù„ Ù…Ù† 4.0. Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù†Ø¬Ø§Ø­ Ù‡Ùˆ 2.0. Ø§Ù„Ø¥Ù†Ø°Ø§Ø± Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ Ø¹Ù†Ø¯ Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø¹Ù† 2.0.',
    'Ø§Ù„ØªÙ‚Ø¯ÙŠØ±Ø§Øª': 'A: 90-100ØŒ B: 80-89ØŒ C: 70-79ØŒ D: 60-69ØŒ F: Ø£Ù‚Ù„ Ù…Ù† 60'
  },

  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
  contact: {
    'Ø§Ù„Ù‡Ø§ØªÙ': '+962-6-4291511',
    'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': 'Ù…Ø·Ø§Ø± Ø§Ù„Ù…Ù„ÙƒØ© Ø¹Ù„ÙŠØ§Ø¡ Ø§Ù„Ø¯ÙˆÙ„ÙŠØŒ Ø¹Ù…Ø§Ù†ØŒ Ø§Ù„Ø£Ø±Ø¯Ù†',
    'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ': 'info@meu.edu.jo',
    'Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„': 'Ø§Ù„Ø£Ø­Ø¯ - Ø§Ù„Ø®Ù…ÙŠØ³: 8:00 Øµ - 4:00 Ù…',
    'Ø§Ù„Ù‚Ø¨ÙˆÙ„ ÙˆØ§Ù„ØªØ³Ø¬ÙŠÙ„': 'admission@meu.edu.jo',
    'Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„Ù…Ø§Ù„ÙŠØ©': 'finance@meu.edu.jo'
  }
};

// Ø¥Ø¹Ø¯Ø§Ø¯ OpenAI client
const openai = new OpenAI({
  apiKey: 'demo-key', // Ù…Ø¤Ù‚Øª Ù„Ù„ØªØ·ÙˆÙŠØ±
  dangerouslyAllowBrowser: true
});

// ÙˆØ¸ÙŠÙØ© Ù„Ù„Ø¨Ø­Ø« ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
const searchLocalKnowledge = (question) => {
  const lowerQuestion = question.toLowerCase();
  
  // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„
  for (const [key, value] of Object.entries(MEU_KNOWLEDGE_BASE.registration)) {
    if (lowerQuestion.includes(key.toLowerCase()) || 
        lowerQuestion.includes('ØªØ³Ø¬ÙŠÙ„') || 
        lowerQuestion.includes('Ø±Ø³ÙˆÙ…') ||
        lowerQuestion.includes('Ù…Ù†Ø­') ||
        lowerQuestion.includes('Ø§Ù†Ø³Ø­Ø§Ø¨') ||
        lowerQuestion.includes('ØªØ£Ø¬ÙŠÙ„')) {
      return `ðŸ“š **${key}:**\n\n${value}\n\nÙ„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø¹Ù…Ø§Ø¯Ø© Ø§Ù„Ù‚Ø¨ÙˆÙ„ ÙˆØ§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¹Ù„Ù‰: admission@meu.edu.jo`;
    }
  }

  // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ÙƒÙ„ÙŠØ§Øª ÙˆØ§Ù„ØªØ®ØµØµØ§Øª
  if (lowerQuestion.includes('ØªØ®ØµØµ') || lowerQuestion.includes('ÙƒÙ„ÙŠØ©') || lowerQuestion.includes('Ù‚Ø³Ù…')) {
    let response = 'ðŸ›ï¸ **Ø§Ù„ÙƒÙ„ÙŠØ§Øª ÙˆØ§Ù„ØªØ®ØµØµØ§Øª ÙÙŠ Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø·:**\n\n';
    for (const [faculty, majors] of Object.entries(MEU_KNOWLEDGE_BASE.faculties)) {
      response += `**${faculty}:**\n${majors.map(major => `â€¢ ${major}`).join('\n')}\n\n`;
    }
    return response + 'Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø­ÙˆÙ„ Ø£ÙŠ ØªØ®ØµØµØŒ ÙŠØ±Ø¬Ù‰ Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: www.meu.edu.jo';
  }

  // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø±Ø§ÙÙ‚ ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª
  for (const [key, value] of Object.entries(MEU_KNOWLEDGE_BASE.facilities)) {
    if (lowerQuestion.includes(key.toLowerCase()) ||
        lowerQuestion.includes('Ù…ÙƒØªØ¨Ø©') ||
        lowerQuestion.includes('Ù…Ø®ØªØ¨Ø±') ||
        lowerQuestion.includes('ÙƒØ§ÙØªÙŠØ±ÙŠØ§') ||
        lowerQuestion.includes('Ù…ÙˆÙ‚Ù') ||
        lowerQuestion.includes('Ù…Ù„Ø¹Ø¨')) {
      return `ðŸ¢ **${key}:**\n\n${value}`;
    }
  }

  // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª
  if (lowerQuestion.includes('Ø§Ù…ØªØ­Ø§Ù†') || lowerQuestion.includes('Ø¯Ø±Ø¬Ø©') || 
      lowerQuestion.includes('Ù…Ø¹Ø¯Ù„') || lowerQuestion.includes('Ù†ØªØ§Ø¦Ø¬')) {
    let response = 'ðŸ“Š **Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª ÙˆØ§Ù„Ø¯Ø±Ø¬Ø§Øª:**\n\n';
    for (const [key, value] of Object.entries(MEU_KNOWLEDGE_BASE.exams)) {
      response += `**${key}:** ${value}\n\n`;
    }
    return response;
  }

  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
  if (lowerQuestion.includes('Ø§ØªØµØ§Ù„') || lowerQuestion.includes('Ù‡Ø§ØªÙ') || 
      lowerQuestion.includes('Ø¹Ù†ÙˆØ§Ù†') || lowerQuestion.includes('Ù…ÙˆÙ‚Ø¹')) {
    let response = 'ðŸ“ž **Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„:**\n\n';
    for (const [key, value] of Object.entries(MEU_KNOWLEDGE_BASE.contact)) {
      response += `**${key}:** ${value}\n\n`;
    }
    return response;
  }

  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ø§Ù…Ø© Ø¹Ù† Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©
  if (lowerQuestion.includes('Ø¬Ø§Ù…Ø¹Ø©') || lowerQuestion.includes('meu') || 
      lowerQuestion.includes('Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø·') || lowerQuestion.includes('Ø¹Ù† Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©')) {
    const general = MEU_KNOWLEDGE_BASE.general;
    return `ðŸ›ï¸ **Ø¹Ù† Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø·:**\n\n` +
           `â€¢ **Ø§Ù„Ø§Ø³Ù…:** ${general.name} (${general.englishName})\n` +
           `â€¢ **Ø§Ù„Ù…ÙˆÙ‚Ø¹:** ${general.location}\n` +
           `â€¢ **ØªØ£Ø³Ø³Øª:** ${general.founded}\n` +
           `â€¢ **Ø§Ù„Ù†ÙˆØ¹:** ${general.type}\n` +
           `â€¢ **Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯:** ${general.accreditation}\n` +
           `â€¢ **Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:** ${general.website}\n\n` +
           `Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø· Ù‡ÙŠ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø§Øª Ø§Ù„Ø±Ø§Ø¦Ø¯Ø© ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©ØŒ ØªÙ‚Ø¯Ù… ØªØ¹Ù„ÙŠÙ…Ø§Ù‹ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø© ÙÙŠ Ø¨ÙŠØ¦Ø© Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ù…ØªÙ…ÙŠØ²Ø©.`;
  }

  return null;
};

// ÙˆØ¸ÙŠÙØ© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø¬Ø§Ø¨Ø© Ù…Ù† Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
export const getAIResponse = async (question) => {
  try {
    // Ø£ÙˆÙ„Ø§Ù‹ØŒ Ø§Ø¨Ø­Ø« ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
    const localResponse = searchLocalKnowledge(question);
    if (localResponse) {
      return localResponse;
    }

    // Ø¥Ø¬Ø§Ø¨Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù…Ø­Ø³Ù†Ø© Ù„Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
    const enhancedResponses = {
      'Ù…Ø±Ø­Ø¨Ø§': 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ask MEU! ðŸ‘‹\n\nØ£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ù„Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø·. ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ:\n\nâ€¢ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ù„Ø±Ø³ÙˆÙ…\nâ€¢ Ø§Ù„ØªØ®ØµØµØ§Øª ÙˆØ§Ù„ÙƒÙ„ÙŠØ§Øª\nâ€¢ Ø§Ù„Ù…Ø±Ø§ÙÙ‚ ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª\nâ€¢ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª ÙˆØ§Ù„Ø¯Ø±Ø¬Ø§Øª\nâ€¢ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„\n\nÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ',
      
      'Ø´ÙƒØ±Ø§': 'Ø§Ù„Ø¹ÙÙˆ! ðŸ˜Š Ø£ØªÙ…Ù†Ù‰ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ÙÙŠØ¯Ø© Ù„Ùƒ. Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙƒ Ø£ÙŠ Ø£Ø³Ø¦Ù„Ø© Ø£Ø®Ø±Ù‰ Ø­ÙˆÙ„ Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø·ØŒ Ù„Ø§ ØªØªØ±Ø¯Ø¯ ÙÙŠ Ø§Ù„Ø³Ø¤Ø§Ù„!',
      
      'ÙˆÙ‚Øª': 'Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ ÙÙŠ Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø·:\n\nðŸ• **Ø§Ù„Ø¯ÙˆØ§Ù… Ø§Ù„Ø±Ø³Ù…ÙŠ:**\nØ§Ù„Ø£Ø­Ø¯ - Ø§Ù„Ø®Ù…ÙŠØ³: 8:00 Øµ - 4:00 Ù…\n\nðŸ“š **Ø§Ù„Ù…ÙƒØªØ¨Ø©:**\nØ§Ù„Ø£Ø­Ø¯ - Ø§Ù„Ø®Ù…ÙŠØ³: 8:00 Øµ - 8:00 Ù…\n\nðŸ½ï¸ **Ø§Ù„ÙƒØ§ÙØªÙŠØ±ÙŠØ§:**\nØ§Ù„Ø£Ø­Ø¯ - Ø§Ù„Ø®Ù…ÙŠØ³: 7:30 Øµ - 6:00 Ù…',
      
      'Ù…Ø³Ø§Ø¹Ø¯Ø©': 'ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£Ù…ÙˆØ± Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø·:\n\nðŸ“š **Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©:**\nâ€¢ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„\nâ€¢ Ø§Ù„Ø±Ø³ÙˆÙ… ÙˆØ§Ù„Ù…Ù†Ø­\nâ€¢ Ø§Ù„ØªØ®ØµØµØ§Øª ÙˆØ§Ù„Ù…Ù†Ø§Ù‡Ø¬\nâ€¢ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª ÙˆØ§Ù„Ø¯Ø±Ø¬Ø§Øª\n\nðŸ¢ **Ø§Ù„Ø®Ø¯Ù…Ø§Øª:**\nâ€¢ Ø§Ù„Ù…Ø±Ø§ÙÙ‚ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ©\nâ€¢ Ø§Ù„Ù…ÙƒØªØ¨Ø© ÙˆØ§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª\nâ€¢ Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠØ©\n\nðŸ“ž **Ø§Ù„ØªÙˆØ§ØµÙ„:**\nâ€¢ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡ÙˆØ§ØªÙ\nâ€¢ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©\nâ€¢ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„\n\nØ§Ø³Ø£Ù„ Ø¹Ù† Ø£ÙŠ Ù…ÙˆØ¶ÙˆØ¹ ØªØ±ÙŠØ¯ Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ø¹Ù†Ù‡!'
    };

    // Ù…Ø­Ø§ÙƒØ§Ø© ØªØ£Ø®ÙŠØ± Ø§Ù„Ø´Ø¨ÙƒØ©
    await new Promise(resolve => setTimeout(resolve, 1200));

    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¥Ø¬Ø§Ø¨Ø© Ù…Ù†Ø§Ø³Ø¨Ø©
    for (let key in enhancedResponses) {
      if (question.toLowerCase().includes(key)) {
        return enhancedResponses[key];
      }
    }
    
    // Ø¥Ø¬Ø§Ø¨Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù…Ø­Ø³Ù†Ø©
    return `Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ Ø¹Ù„Ù‰ Ø³Ø¤Ø§Ù„Ùƒ! ðŸ¤”\n\nÙ„Ù… Ø£Ø¬Ø¯ Ø¥Ø¬Ø§Ø¨Ø© Ù…Ø­Ø¯Ø¯Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©ØŒ ÙˆÙ„ÙƒÙ† ÙŠÙ…ÙƒÙ†Ùƒ:\n\nðŸ“ž **Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±:**\nâ€¢ Ø§Ù„Ù‡Ø§ØªÙ: +962-6-4291511\nâ€¢ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: info@meu.edu.jo\n\nðŸŒ **Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:**\nwww.meu.edu.jo\n\nðŸ¢ **Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©:**\nÙ…Ø·Ø§Ø± Ø§Ù„Ù…Ù„ÙƒØ© Ø¹Ù„ÙŠØ§Ø¡ Ø§Ù„Ø¯ÙˆÙ„ÙŠØŒ Ø¹Ù…Ø§Ù†ØŒ Ø§Ù„Ø£Ø±Ø¯Ù†\n\nÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù… Ø³ÙŠÙƒÙˆÙ† Ø³Ø¹ÙŠØ¯Ø§Ù‹ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ! ðŸ˜Š`;
    
  } catch (error) {
    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ:', error);
    return 'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ØªÙ‚Ù†ÙŠ Ù…Ø¤Ù‚Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø£Ùˆ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ØªÙ‚Ù†ÙŠ Ø¹Ù„Ù‰: info@meu.edu.jo ðŸ“§';
  }
};

// ÙˆØ¸ÙŠÙØ© Ù„ØªØ­Ù„ÙŠÙ„ Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„ (Ù…Ø­Ø³Ù†Ø©)
export const analyzeQuestion = (question) => {
  const lowerQuestion = question.toLowerCase();
  
  const categories = {
    registration: ['ØªØ³Ø¬ÙŠÙ„', 'Ø±Ø³ÙˆÙ…', 'Ù…Ù†Ø­', 'Ù‚Ø¨ÙˆÙ„', 'ØªØ£Ø¬ÙŠÙ„', 'Ø§Ù†Ø³Ø­Ø§Ø¨'],
    academic: ['ØªØ®ØµØµ', 'ÙƒÙ„ÙŠØ©', 'Ù…Ø§Ø¯Ø©', 'Ù…Ù‚Ø±Ø±', 'Ù…Ù†Ù‡Ø¬', 'Ø¯Ø±Ø§Ø³Ø©'],
    facilities: ['Ù…ÙƒØªØ¨Ø©', 'Ù…Ø®ØªØ¨Ø±', 'ÙƒØ§ÙØªÙŠØ±ÙŠØ§', 'Ù…ÙˆÙ‚Ù', 'Ù…Ù„Ø¹Ø¨', 'Ù‚Ø§Ø¹Ø©'],
    exams: ['Ø§Ù…ØªØ­Ø§Ù†', 'Ø¯Ø±Ø¬Ø©', 'Ù…Ø¹Ø¯Ù„', 'Ù†ØªÙŠØ¬Ø©', 'ØªÙ‚Ø¯ÙŠØ±'],
    contact: ['Ø§ØªØµØ§Ù„', 'Ù‡Ø§ØªÙ', 'Ø¹Ù†ÙˆØ§Ù†', 'Ù…ÙˆÙ‚Ø¹', 'Ø¨Ø±ÙŠØ¯'],
    general: ['Ø¬Ø§Ù…Ø¹Ø©', 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', 'Ø¹Ù†', 'meu']
  };

  for (const [category, keywords] of Object.entries(categories)) {
    if (keywords.some(keyword => lowerQuestion.includes(keyword))) {
      return category;
    }
  }
  
  return 'general';
};